"use strict";(()=>{var e={};e.id=373,e.ids=[373],e.modules={9993:e=>{e.exports=require("googleapis")},2113:e=>{e.exports=require("next-auth/next")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},7733:(e,t,r)=>{r.r(t),r.d(t,{config:()=>p,default:()=>c,routeModule:()=>f});var s={};r.r(s),r.d(s,{default:()=>d});var a=r(1802),o=r(7153),n=r(6249),i=r(9993),u=r(2113),l=r(8023);async function d(e,t){let r;let s="2026년";try{r=await (0,u.getServerSession)(e,t,l.authOptions)}catch(e){console.error("Session Error:",e)}if(!r)return t.status(401).json({error:"로그인이 필요합니다."});let a=new i.google.auth.OAuth2(process.env.GOOGLE_CLIENT_ID,process.env.GOOGLE_CLIENT_SECRET);a.setCredentials({access_token:r.accessToken});let o=i.google.sheets({version:"v4",auth:a}),n=process.env.GOOGLE_SHEET_ID;if("POST"===e.method)try{let{name:r,date:a}=e.body;if(!r||!a)return t.status(400).json({error:"Missing name or date"});let i=(await o.spreadsheets.values.get({spreadsheetId:n,range:`${s}!A:X`})).data.values||[],u=-1;for(let e=0;e<i.length;e++)if(i[e][0]===r){u=e;break}if(-1===u)return t.status(404).json({error:"User not found"});let l=-1,d=i[u]||[];for(let e=4;e<=23;e++)if(!d[e]||""===d[e].trim()){l=e;break}if(-1===l)return t.status(400).json({error:"연차 저장 공간이 부족합니다."});let c=u+1,p=String.fromCharCode(65+l),f=`${s}!${p}${c}`;return await o.spreadsheets.values.update({spreadsheetId:n,range:f,valueInputOption:"USER_ENTERED",requestBody:{values:[[a]]}}),t.status(200).json({success:!0,message:`Added to ${f}`})}catch(e){return console.error("Add Error:",e),t.status(500).json({error:e.message})}if("DELETE"===e.method)try{let{name:r,date:a}=e.body;if(!r||!a)return t.status(400).json({error:"Missing name or date"});let i=(await o.spreadsheets.values.get({spreadsheetId:n,range:`${s}!A:Z`})).data.values||[],u=-1;for(let e=0;e<i.length;e++)if(i[e][0]===r){u=e;break}if(-1===u)return t.status(404).json({error:"User not found"});let l=-1,d=i[u];for(let e=4;e<d.length;e++)if(d[e]&&d[e].trim()===a.trim()){l=e;break}if(-1===l)return t.status(404).json({error:"Date not found"});let c=u+1,p=String.fromCharCode(65+l),f=`${s}!${p}${c}`;return await o.spreadsheets.values.clear({spreadsheetId:n,range:f}),t.status(200).json({success:!0,message:`Deleted ${f}`})}catch(e){return console.error("Delete Error:",e),t.status(500).json({error:e.message})}if("PUT"===e.method)try{let{name:r,oldDate:a,newDate:i}=e.body;if(!r||!a||!i)return t.status(400).json({error:"Missing params"});let u=(await o.spreadsheets.values.get({spreadsheetId:n,range:`${s}!A:Z`})).data.values||[],l=-1;for(let e=0;e<u.length;e++)if(u[e][0]===r){l=e;break}if(-1===l)return t.status(404).json({error:"User not found"});let d=-1,c=u[l];for(let e=4;e<c.length;e++)if(c[e]&&c[e].trim()===a.trim()){d=e;break}if(-1===d)return t.status(404).json({error:"Original date not found"});let p=l+1,f=String.fromCharCode(65+d),E=`${s}!${f}${p}`;return await o.spreadsheets.values.update({spreadsheetId:n,range:E,valueInputOption:"USER_ENTERED",requestBody:{values:[[i]]}}),t.status(200).json({success:!0,message:`Updated ${E}`})}catch(e){return console.error("Update Error:",e),t.status(500).json({error:e.message})}return t.status(405).json({error:"Method not allowed"})}let c=(0,n.l)(s,"default"),p=(0,n.l)(s,"config"),f=new a.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/calendar",pathname:"/api/calendar",bundlePath:"",filename:""},userland:s})},8023:(e,t,r)=>{r.r(t),r.d(t,{authOptions:()=>n,default:()=>i});let s=require("next-auth");var a=r.n(s);let o=require("next-auth/providers/google"),n={providers:[r.n(o)()({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET,authorization:{params:{scope:"openid email profile https://www.googleapis.com/auth/spreadsheets https://www.googleapis.com/auth/drive.metadata.readonly",prompt:"consent",access_type:"offline",response_type:"code"}}})],secret:process.env.NEXTAUTH_SECRET,callbacks:{async jwt({token:e,account:t}){if(t){e.accessToken=t.access_token;try{let r=process.env.GOOGLE_SHEET_ID,s=await fetch(`https://www.googleapis.com/drive/v3/files/${r}?fields=capabilities(canEdit)`,{headers:{Authorization:`Bearer ${t.access_token}`}}),a=await s.json();e.isAdmin=a?.capabilities?.canEdit||!1}catch(t){console.error("Permission Check Error:",t),e.isAdmin=!1}}return e},session:async({session:e,token:t})=>(e.accessToken=t.accessToken,e.isAdmin=t.isAdmin,e)}},i=a()(n)},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=7733);module.exports=r})();