"use strict";(()=>{var e={};e.id=149,e.ids=[149],e.modules={9993:e=>{e.exports=require("googleapis")},2113:e=>{e.exports=require("next-auth/next")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,s){return s in t?t[s]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,s)):"function"==typeof t&&"default"===s?t:void 0}}})},6256:(e,t,s)=>{s.r(t),s.d(t,{config:()=>h,default:()=>d,routeModule:()=>E});var r={};s.r(r),s.d(r,{default:()=>u});var a=s(1802),o=s(7153),n=s(6249),i=s(9993),l=s(2113),c=s(8023);async function u(e,t){let s=null,r="연차계산";try{s=await (0,l.getServerSession)(e,t,c.authOptions)}catch(e){console.error("Session Check Error:",e)}if("POST"===e.method){if(!s)return t.status(401).json({error:"데이터를 저장하려면 로그인이 필요합니다."});try{let a=new i.google.auth.OAuth2(process.env.GOOGLE_CLIENT_ID,process.env.GOOGLE_CLIENT_SECRET);a.setCredentials({access_token:s.accessToken});let o=i.google.sheets({version:"v4",auth:a}),n=process.env.GOOGLE_SHEET_ID,l=e.body.map(e=>[e.name,e.role,e.date,e.total,e.used,e.memo]);return await o.spreadsheets.values.clear({spreadsheetId:n,range:`${r}!A2:F1000`}),await o.spreadsheets.values.update({spreadsheetId:n,range:`${r}!A2`,valueInputOption:"USER_ENTERED",requestBody:{values:l}}),t.status(200).json({success:!0})}catch(e){return console.error("Save Error:",e),t.status(500).json({error:e.message})}}if("GET"===e.method)try{let e=[],a=[],o=!1;if(s&&s.accessToken)try{let t=new i.google.auth.OAuth2(process.env.GOOGLE_CLIENT_ID,process.env.GOOGLE_CLIENT_SECRET);t.setCredentials({access_token:s.accessToken});let n=i.google.sheets({version:"v4",auth:t}),l=process.env.GOOGLE_SHEET_ID,[c,u]=await Promise.all([n.spreadsheets.values.get({spreadsheetId:l,range:`${r}!A2:F`}),n.spreadsheets.values.get({spreadsheetId:l,range:`2026년!A3:ZZ`})]);e=c.data.values||[],a=u.data.values||[],o=!0}catch(e){console.error("Google API Fetch Failed (Falling back to CSV):",e.message)}if(!o){let t="https://docs.google.com/spreadsheets/d/1dmMlb4IxUQO9AZBVSAgS72cXDJqWDLicx-FL0IzH5Eo/export?format=csv",s=`${t}&gid=0`,r=`${t}&gid=191374435`,[o,n]=await Promise.all([fetch(s).then(e=>e.ok?e.text():""),fetch(r).then(e=>e.ok?e.text():"")]),i=p(o),l=p(n);e=i.slice(1),a=l.slice(2)}let n={};a.forEach(e=>{let t=e[0],s=[];for(let t=4;t<e.length;t++){let r=e[t]?e[t].trim():"";if(r)try{let e="";r.toUpperCase().includes("AM")?e="AM":r.toUpperCase().includes("PM")&&(e="PM");let t=r.replace(/AM|PM/gi,"").trim(),a=(t=t.replace(/\//g,"-")).split("-");if(a.length>=2){let t=a[0].padStart(2,"0"),o=a[1].padStart(2,"0"),n=`2026-${t}-${o}`;e&&(n+=` (${e})`),s.push({parsed:n,original:r})}else s.push({parsed:r,original:r})}catch(e){s.push({parsed:r,original:r})}}t&&(n[t]=s)});let l=e.map(e=>{let t=e[0]||"",s={name:t,role:e[1]||"",date:e[2]||"",total:Number(e[3])||0,used:Number(e[4])||0,memo:e[5]||""};return s.leaves=n[t]||[],s});return t.status(200).json(l)}catch(e){return console.error("Fetch Error:",e),t.status(200).json([])}}function p(e){if(!e)return[];let t=[],s=[],r="",a=!1;for(let o=0;o<e.length;o++){let n=e[o],i=e[o+1];'"'===n?a&&'"'===i?(r+='"',o++):a=!a:","!==n||a?"\r"!==n&&"\n"!==n||a?r+=n:("\r"===n&&"\n"===i&&o++,s.push(r.trim()),s.length>0&&s.some(e=>""!==e)&&t.push(s),s=[],r=""):(s.push(r.trim()),r="")}return(r||s.length>0)&&(s.push(r.trim()),s.some(e=>""!==e)&&t.push(s)),t}let d=(0,n.l)(r,"default"),h=(0,n.l)(r,"config"),E=new a.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/sheets",pathname:"/api/sheets",bundlePath:"",filename:""},userland:r})},8023:(e,t,s)=>{s.r(t),s.d(t,{authOptions:()=>n,default:()=>i});let r=require("next-auth");var a=s.n(r);let o=require("next-auth/providers/google"),n={providers:[s.n(o)()({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET,authorization:{params:{scope:"openid email profile https://www.googleapis.com/auth/spreadsheets https://www.googleapis.com/auth/drive.metadata.readonly",prompt:"consent",access_type:"offline",response_type:"code"}}})],secret:process.env.NEXTAUTH_SECRET,callbacks:{async jwt({token:e,account:t}){if(t){e.accessToken=t.access_token;try{let s=process.env.GOOGLE_SHEET_ID,r=await fetch(`https://www.googleapis.com/drive/v3/files/${s}?fields=capabilities(canEdit)`,{headers:{Authorization:`Bearer ${t.access_token}`}}),a=await r.json();e.isAdmin=a?.capabilities?.canEdit||!1}catch(t){console.error("Permission Check Error:",t),e.isAdmin=!1}}return e},session:async({session:e,token:t})=>(e.accessToken=t.accessToken,e.isAdmin=t.isAdmin,e)}},i=a()(n)},7153:(e,t)=>{var s;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return s}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(s||(s={}))},1802:(e,t,s)=>{e.exports=s(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var s=t(t.s=6256);module.exports=s})();